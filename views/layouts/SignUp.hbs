<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/png" href="images/icon.png" sizes="32x32"/>
    <title>Edu Own Your Knowledge</title>
    <meta charset="UTF-8">
    <meta name="keywords" content="Course, Education">
    <meta name="description" content="Web Video Courses">
    <meta name="author" content="nmcntt_18CLC2_Group 11">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        *{
            font-family: 'Open Sans', sans-serif;
            box-sizing: border-box;
        }
        body{
            background-image:url("images/bg.png");
            background-size:100%;
            background-position: center center;
        }
        .im {
            max-width:210px;
            max-height:95px;
            width: auto;
            height: auto;
        }
        .allde{
            max-width:600px;
            max-height:360px;
            width: auto;
            height: auto;
            margin-top:120px;
        }
        .f {
            width:400px;
            height:40px;
            font-size:130%;
            padding-left:15px;
        }
        .f:hover {
            background-color: rgb(205, 241, 229);
            outline: 0;
            border: 2px solid rgb(140, 140, 173);
            border-radius: 7px;
        }
        .f:focus{
            background-color: rgb(205, 241, 229);
            outline: 0;
            border: 2px solid blueviolet;
            border-radius: 7px;
        }
        .but {
            width:160px;
            height:50px;
            background-color: red;
            font-size: 125%;
            color:white;
            border-radius: 20px;
            font-stretch:semi-condensed;
        }
    </style>
</head>
<body>
    <div id="fb-root"></div>
<form method="POST" id="frmSignUp">
    <table style="width:90%;margin-left:50px;" cellspacing="5px">
        <colgroup><col width="500px"></colgroup>
        <tr>
            <td><a href="/"><img src="images/logo1.png" class="im" alt="logo"></a></td>
            <td align="right"><a href="/account/login" style="color:red;margin-right:110px;">Đăng nhập</a></td>
        </tr>
        <tr>
            <td><div style="text-align:center;"><h1>Nền tảng giáo dục trực tuyến<br>lớn nhất Đông Nam Á</h1></div></td>
            <td rowspan="10"><img src="images/all_device.png" alt="Devices using OYK" class="allde"></td>
        </tr>
        <tr>
            <td style="color:grey">Nơi mọi người chia sẻ , khám phá và học hỏi bất cứ điều gì</td>
        </tr>
        <!--
        <tr>
            <td><br>Đăng kí nhanh với</td>
        </tr>
        <tr>
            <td>
                
                <div class="fb-login-button" data-size="large" data-button-type="continue_with" 
                data-layout="default" data-auto-logout-link="false" data-use-continue-as="false" data-width=""></div>
                
                <div class="fb-login-button" data-size="medium" data-button-type="continue_with" data-layout="default" data-auto-logout-link="false" data-use-continue-as="false" data-width=""></div>
                <button>Gmail</button>
            </td>
        </tr>
        -->
        {{#if err_message}}
        <td>
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          {{err_message}}
        </div>
        </td>
        {{/if}}
        <tr>
            <td><br><span style="font-weight: bolder;">Đăng kí ngay:</span></td>
        </tr>
        <tr>
            <td><input id="ho" class="f" type="text" name="ho" placeholder="Họ" maxlength="20" autocomplete="off"></td>
        </tr>
        <tr>
            <td><input id="ten" class="f" type="text" name="ten" placeholder="Tên" maxlength="30" autocomplete="off"></td>
        </tr>
        <tr>
            <td><input id="tk" class="f" type="text" name="email" placeholder="Email" maxlength="50" autocomplete="off"></td>
        </tr>
        <tr>
            <td><input id="pass" class="f" type="password" name="pass" placeholder="Mật khẩu" maxlength="20" autocomplete="off"></td>
        </tr>
        <tr>
            <td>Bằng cách nhấp vào Đăng ký, bạn đồng ý với <a href="dieukhoan.html">Điều khoản</a>,<br>
                <a href="quyche.html">Quy chế hoạt động</a> và <a href="chinhsach.html">Chính sách bảo mật</a> của EduOYK.</td>
        </tr>
    </table>
    <div>
        <table style="margin-left:50px;" cellspacing="15">
            <tr>
                <td><input id="submit" class="but" type="submit" name="send" value="Đăng ký"></td>
                <td>
                    <div>
                        <p>Đã có tài khoản? <a href="account/login">Đăng nhập</a></p>
                    </div>
                </td>
            </tr>
    </table>
    </div>
</form>
<script>
    function checkName(){
        var ho = document.getElementById('ho');
        var ten = document.getElementById('ten');
        if(ho.value.length === 0 || ten.value.length === 0 ){
            alert("Không được để trống họ và tên");
            tk.focus();
            return false;
        }
        for(var i=0; i<ho.value.length;i++){
            if(!isNaN(ho.value.charAt(i))){
                if(ho.value.charAt(i)===' '){
                    continue;
                }   
                alert("Tên không thể có số ---> vị trí "+(i+1));
                ho.focus();
                return false;
            }
        }
        for(var i=0; i<ten.value.length;i++){
            if(!isNaN(ten.value.charAt(i))){
                if(ten.value.charAt(i)===' '){
                    continue;
                }
                alert("Tên không thể có số ---> vị trí "+(i+1));
                ten.focus();
                return false;
            }
        }
        return true;
    }

    function isNull(){
        var tk = document.getElementById('tk');
        var pass = document.getElementById('pass');
        if(tk.value.length === 0 ){
            alert("Không được để trống tài khoản đăng nhập");
            tk.focus();
            return false;
        }
        if(pass.value.length === 0 ){
            alert("Xin hãy nhập mật khẩu")
            pass.focus();
            return false;
        }
        return true;
    }

    function validateEmail() {
        var tk = document.getElementById('tk');
        var validRegex = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
        if (tk.value.match(validRegex)) {
            return true;
        } else {
            alert("Invalid email address!");
            tk.focus();
            return false;
        }
    }

    $(document).ready(function(){
        $("#frmSignUp").on('submit',function(event){
            event.preventDefault();
            if(checkName()===false)         return;
            if(isNull()===false)            return;
            if(validateEmail()===false)     return;

            $.getJSON({
                url: `/account/sendtoken`,
                success: function(data){
                    //nothing
                }
            })

            const email = $("#tk").val();
            $.getJSON({
                url: `/account/is-available?email=${email}`,
                success: function(data){
                    if(data === true){
                        $("#frmSignUp").off('submit').submit();
                    }else{
                        alert('This email has been registered !!');
                    }
                }
            })
        })
    })
</script>
</body>
</html>